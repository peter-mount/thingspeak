<!DOCTYPE html>
<html style="height: 100%;">
  <head>
    <script type="text/javascript" src="../../assets/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/javascripts/highcharts-3.0.8.js"></script>
    <script type="text/javascript" src="../../assets/javascripts/exporting.js"></script>
    <script src="../../assets/javascripts/raphael-2.1.4.min.js"></script>
    <script src="../../assets/javascripts/justgage-1.1.0.min.js"></script>
    <script src="../../assets/javascripts/gauge.min.js"></script>
    <script>
        $(document).on('page:load ready', function(){
            var chartOptions = {
              chart: {
                renderTo: 'chart-container',
                defaultSeriesType: '<%= params[:type] ? "#{params[:type]}" : "line" %>',
                backgroundColor: '<%= params[:bgcolor] || "#ffffff" %>',
                events: {
                  
              }
          },
          title: {
              text: ''
          },
          plotOptions: {
            line: {
              color: '<%= params[:color] || "#d62020" %>'
            },
            bar: {
              color: '<%= params[:color] || "#d62020" %>'
            },
            column: {
              color: '<%= params[:color] || "#d62020" %>'
            },
            spline: {
              color: '<%= params[:color] || "#d62020" %>'
            },
            series: {
              marker: {
                radius: 3
              },
              animation: true,
              step: <%= params[:step] || 'false' %>,
              borderWidth: 0,
              turboThreshold: 0
            }
          },
          tooltip: {
              // reformat the tooltips so that local times are displayed
              formatter: function() {
            var d = new Date(this.x + (myOffset*60000));
            var n = (this.point.name === undefined) ? '' : '<br/>' + this.point.name;
            return this.series.name + ':<b>' + this.y + '</b>' + n + '<br/>' + d.toDateString() + '<br/>' + d.toTimeString().replace(/\(.*\)/, "");
              }
          },
          xAxis: {
              type: 'datetime',
              title: {
            text: 'test'
              }
          },
          yAxis: {
            title: {
              text: ''
            },
            min: <%= params[:yaxismin].present? ? params[:yaxismin] : 'null '%>,
            max: <%= params[:yaxismax].present? ? params[:yaxismax] : 'null' %>
          },
          exporting: {
              enabled: <%= (params[:export].present? && params[:export] == 'true') ? 'true' : 'false' %>
          },
          legend: {
              enabled: false
          },
          series: [
            { name: data.channel.field<%= params[:id] %> }
          ],
          credits: {
              text: '易智云仪表',
              href: 'http://101.6.215.9/',
              style: { color: '#D62020' }
          }
        };

            // add the data to the chart
            chartOptions.series[0].data = chartData;

            // set chart labels here so that decoding occurs properly
            chartOptions.title.text = <% if params[:title] %>decodeURIComponent('<%= u(params[:title]) %>')<% else %>data.channel.name<% end %>;
            chartOptions.xAxis.title.text = <% if params[:xaxis] %>decodeURIComponent('<%= u(params[:xaxis]) %>')<% else %>'Date'<% end %>;
            chartOptions.yAxis.title.text = <% if params[:yaxis] %>decodeURIComponent('<%= u(params[:yaxis]) %>')<% else %><%= "data.channel.field#{params[:id]}" %><% end %>;

            // draw the chart
            var dynamicChart = new Highcharts.Chart(chartOptions);
              
        });
    </script>

    <%= javascript_include_tag 'application' %>

</head>
<body style='background-color: <%= params[:bgcolor] ? params[:bgcolor] : 'white' %>; height: 100%; margin: 0; padding: 0;'>
  <div id="chart-container" style="<%= @width_style %> <%= @height_style %> display: block; position:absolute; bottom:0; top:0; left:0; right:0; margin: 5px 15px 15px 0; overflow: hidden;">
    <canvas id="foo"></canvas>
    <%= image_tag 'ajax-loader.gif', :style => "position: absolute; margin: auto; top: 0; left: 0; right: 0; bottom: 0;" %>
  </div>
</body>
</html>